services:
  capjs:
    build: capjs/standalone
    # restart: unless-stopped
    user: "1000:1000"   # stesso utente dell'init
    ports:
      - "3000:3000"
    volumes:
      - ./data:/data
      # opzionale: montare config dallâ€™host
      # - ./etc/cap.config.js:/app/cap.config.js:ro
    environment:
      DATA_PATH: /data
      # in produzione spostare su un secret/vault
      ADMIN_KEY: your_secret_password_your_secret_password
      WIDGET_VERSION: 0.1.33
      WASM_VERSION: 0.0.6
      ENABLE_ASSETS_SERVER: true
      CORS_ORIGIN: "*"
      LOGIN_PAGE_ENABLED: true
      HIDE_RATELIMIT_IP_WARNING: true

  demo:
    build: ./demo
    user: "1000:1000"
    ports:
      - "5000:5000"
    volumes:
      - ./shared:/shared
    depends_on:
      - demo-init

  demo-init:
    build: ./demo-init
    user: "1000:1000"
    volumes:
      - ./data:/data
      - ./shared:/shared
    restart: "no"
    depends_on:
      - capjs
